<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B4F7KKQ08M"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-B4F7KKQ08M');
    </script>
    <script type="text/javascript"> //<![CDATA[ 
        var tlJsHost = ((window.location.protocol == "https:") ? "https://secure.trust-provider.com/" : "http://www.trustlogo.com/");
        document.write(unescape("%3Cscript src='" + tlJsHost + "trustlogo/javascript/trustlogo.js' type='text/javascript'%3E%3C/script%3E"));
        //]]>
    </script>
    <script async type="application/javascript"
            src="https://news.google.com/swg/js/v1/swg-basic.js"></script>
    <script>
      (self.SWG_BASIC = self.SWG_BASIC || []).push( basicSubscriptions => {
        basicSubscriptions.init({
          type: "NewsArticle",
          isPartOfType: ["Product"],
          isPartOfProductId: "CAow7-3aCw:openaccess",
          clientOptions: { theme: "light", lang: "en" },
        });
      });
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="You You News Trending Content">
    <meta name="author" content="Derek (Yue) Yu">
    <meta name="keywords" content="News, You You, Tech, Sports, TV, Music, Forum, Discussion">
    <title>You You News - By You, For You!</title>
    <link rel="icon" type="image/x-icon" href="/derek-yux.github.io/Assets/youyounewslogo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --light-bg: #f4f4f8;
            --text-color: #333;
        }
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.6;

            background-color: var(--light-bg);
            color: var(--text-color);
        }
        #footerlink a {
            line-height: 1.6;
            color: var(--light-bg);
            font-family: 'Times New Roman', serif;
        }
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background:
                /* top, transparent black, faked with gradient */ 
                linear-gradient(
                    rgba(0, 0, 0, 0.7), 
                    rgba(0, 0, 0, 0.7)
                ),
                /* bottom, image */
                url('/derek-yux.github.io/Assets/lemonadehappy.png');
            background-color: var(--primary-color);
            background-position-y: center;
            background-position-x: center;
            color: white;
            text-align: center;
            padding: 20px 0;
            font-family: 'Times New Roman', serif;
        }
        header h1 {
            font-size: 2.5em;
            letter-spacing: -1px;
        }
        nav {
            background-color: #34495e;
            padding: 10px 0;
        }
        nav ul {
            display: flex;
            justify-content: center;
            list-style: none;
        }
        nav ul li {
            margin: 0 15px;
        }
        nav ul li1 {
            margin: 0 15px;
        }
        nav ul li1 a {
            color: aquamarine;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        nav ul li a:hover {
            color: var(--secondary-color);
        }
        nav ul li1 a:hover {
            color: white;
        }
        .cont2 {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .hidden {
            display: none;
        }
        .post {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .post-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .post-author {
            font-weight: bold;
        }
        .post-time {
            color: #888;
        }
        .message {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-error {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        input, textarea, button {
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        input, textarea {
            width: 100%;
        }
        input.error-field {
            border-color: #dc3545;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .password-requirements {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .password-requirements ul {
            margin: 5px 0;
            padding-left: 20px;
        }
        .comment {
            padding: 10px;
            border-top: 1px solid #eee;
            margin-top: 10px;
        }
        .comment-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
        }
        .comment-author {
            font-weight: bold;
        }
        .comment-time {
            color: #888;
        }
        .reactions-bar {
            display: flex;
            margin: 10px 0;
        }
        .reaction-btn {
            border: none;
            background: #f0f0f0;
            padding: 5px 10px;
            margin-right: 5px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .reaction-btn.active {
            background: var(--secondary-color);
            color: white;
        }
        .avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 15px auto;
            display: block;
        }
        .rank-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            color: white;
            background-color: #7f8c8d;
            margin-left: 5px;
        }
        .rank-Newcomer { background-color: #95a5a6; }
        .rank-Regular { background-color: #3498db; }
        .rank-Active.Member { background-color: #2ecc71; }
        .rank-Forum.Expert { background-color: #f39c12; }
        .rank-Discussion.Master { background-color: #e74c3c; }
        .rank-Forum.Legend { background-color: #9b59b6; }
        
        .profile-section {
            background: white;
            border-radius: 5px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .profile-stats {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }
        .profile-stat {
            text-align: center;
        }
        .profile-stat-value {
            font-size: 1.5em;
            font-weight: bold;
        }
        .profile-section button {
            margin-top: 10px;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            width: 80%;
            max-width: 500px;
            border-radius: 5px;
        }
        .close-btn {
            float: right;
            font-size: 1.5em;
            cursor: pointer;
        }
        /* Comment toggle */
        .comments-section {
            margin-top: 10px;
            display: none;
        }
        .comment-toggle {
            background: none;
            border: none;
            color: var(--secondary-color);
            cursor: pointer;
            font-size: 0.9em;
            padding: 5px;
            margin-top: 5px;
        }
        .points-needed {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-top: 5px;
            text-align: center;
        }
        footer {
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>You You News</h1>
            <p>Your Ultimate Source for Trending Content</p>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="https://www.youyounews.live">Home</a></li>
            <li><a href="https://www.youyounews.live/Pages/tech">Tech</a></li>
            <li><a href="https://www.youyounews.live/Pages/sports">Sports</a></li>
            <li><a href="https://www.youyounews.live/Pages/tv">TV</a></li>
            <li><a href="https://www.youyounews.live/Pages/music">Music</a></li>
            <li1><a href="https://reindeer-blessed-adversely.ngrok-free.app/">Forums</a></li1>
        </ul>
    </nav>
    <br>
    <div id="message-container" class="hidden message"></div>
    <div class="cont2">
    <!-- Login/Register Forms -->
    <div id="auth-forms">
        <h2>Login (Please Log In To See Our Discussions!)</h2>
        <br>
        <form id="login-form">
            <div class="form-group">
                <input type="text" id="login-username" placeholder="Username" required>
                <div id="login-username-error" class="form-error"></div>
            </div>
            <div class="form-group">
                <input type="password" id="login-password" placeholder="Password" required>
                <div id="login-password-error" class="form-error"></div>
            </div>
            <div id="login-general-error" class="form-error"></div>
            <button type="submit">Login</button>
        </form>
        <br>
        
        <h2>Register</h2>
        <div class="password-requirements">
            <strong>Password Requirements:</strong>
            <ul>
                <li>At least 8 characters long</li>
                <li>At least one uppercase letter</li>
                <li>At least one lowercase letter</li>
                <li>At least one number</li>
            </ul>
        </div>
        <form id="register-form">
            <div class="form-group">
                <input type="text" id="register-username" placeholder="Username (4-30 characters, letters, numbers, underscores)" required>
                <div id="register-username-error" class="form-error"></div>
            </div>
            <div class="form-group">
                <input type="password" id="register-password" placeholder="Password" required>
                <div id="register-password-error" class="form-error"></div>
            </div>
            <div id="register-general-error" class="form-error"></div>
            <button type="submit">Register</button>
        </form>
    </div>

    <!-- Forum Section (Hidden until logged in) -->
    <div id="forum-section" class="hidden">
        <div id="user-info">
            <p>Welcome, <span id="username-display"></span>! <button id="logout-btn">Logout</button> <button id="profile-btn">My Profile</button></p>
        </div>

        <!-- Profile Modal -->
        <div id="profile-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn" id="close-profile-modal">&times;</span>
                <h2>My Profile</h2>
                <div class="profile-section">
                    <img id="profile-avatar" class="profile-avatar" src="/derek-yux.github.io/Assets/default.png" alt="Avatar">
                    <h3 id="profile-name">Username</h3>
                    <span id="profile-rank" class="rank-badge rank-Newcomer">Newcomer</span>
                    <p id="profile-bio">No bio yet.</p>
                    
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profile-posts">0</div>
                            <div>Posts</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profile-comments">0</div>
                            <div>Comments</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="profile-points">0</div>
                            <div>Points</div>
                        </div>
                    </div>
                    
                    <div class="points-needed" id="points-needed">20 points needed for next rank</div>
                    
                    <button id="edit-profile-btn">Edit Profile</button>
                </div>
            </div>
        </div>
        
        <!-- Edit Profile Modal -->
        <div id="edit-profile-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn" id="close-edit-profile-modal">&times;</span>
                <h2>Edit Profile</h2>
                <form id="edit-profile-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="display-name">Display Name</label>
                        <input type="text" id="display-name" name="display_name" placeholder="Display Name">
                        <div id="display-name-error" class="form-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="bio">Bio</label>
                        <textarea id="bio" name="bio" placeholder="Tell us about yourself"></textarea>
                        <div id="bio-error" class="form-error"></div>
                    </div>
                    <div class="form-group">
                        <label for="avatar">Avatar</label>
                        <input type="file" id="avatar" name="avatar">
                        <div id="avatar-error" class="form-error"></div>
                    </div>
                    <div id="edit-profile-general-error" class="form-error"></div>
                    <button type="submit">Save Changes</button>
                </form>
            </div>
        </div>

        <h2>Discussion Forum</h2>
        
        <div id="post-form">
            <h3>Create New Post</h3>
            <form id="new-post-form">
                <div class="form-group">
                    <input type="text" id="post-title" placeholder="Title" required>
                    <div id="post-title-error" class="form-error"></div>
                </div>
                <div class="form-group">
                    <textarea id="post-content" placeholder="Write your post here..." required></textarea>
                    <div id="post-content-error" class="form-error"></div>
                </div>
                <div id="post-general-error" class="form-error"></div>
                <button type="submit">Post</button>
            </form>
        </div>
        
        <div id="posts-container">
            <h3>Recent Posts</h3>
            <div id="posts-list">
                <!-- Posts will be loaded here -->
            </div>
        </div>
    </div>
    </div>

    <script>
        // Global variables
        let lastTimestamp = 0;
        let refreshInterval;
        let currentUser = null;
        
        // Reset form errors
        function resetFormErrors(formId) {
            $(`#${formId} .form-error`).hide();
            $(`#${formId} input, #${formId} textarea`).removeClass('error-field');
        }
        
        // Display form error
        function showFormError(elementId, message) {
            $(`#${elementId}`).text(message).show();
            // Add error class to the related input
            const inputId = elementId.replace('-error', '');
            $(`#${inputId}`).addClass('error-field');
        }
        
        // Show message function
        function showMessage(message, isSuccess = true) {
            const messageContainer = $('#message-container');
            messageContainer.removeClass('success error').addClass(isSuccess ? 'success' : 'error');
            messageContainer.text(message).removeClass('hidden');
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                messageContainer.addClass('hidden');
            }, 5000);
        }
        
        function loadUserProfile() {
            $.ajax({
                url: 'get_profile.php',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        const profile = response.data.profile;
                        currentUser = profile;
                        
                        // Update profile modal
                        $('#profile-name').text(profile.display_name || profile.username);
                        $('#profile-bio').text(profile.bio || 'No bio yet.');
                        $('#profile-rank').text(profile.rank).attr('class', 'rank-badge rank-' + profile.rank.replace(' ', '.'));
                        $('#profile-posts').text(profile.post_count);
                        $('#profile-comments').text(profile.comment_count);
                        $('#profile-points').text(profile.points);
                        
                        if (profile.avatar) {
                            $('#profile-avatar').attr('src', 'uploads/avatars/' + profile.avatar);
                        }
                        
                        // Calculate points needed for next rank
                        updatePointsNeeded(profile.points, profile.rank);
                        
                        // Pre-fill edit form
                        $('#display-name').val(profile.display_name || '');
                        $('#bio').val(profile.bio || '');
                    }
                }
            });
        }

        // Check authentication status
        function checkAuth() {
            $.ajax({
                url: 'check_auth.php',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        // User is logged in
                        $('#username-display').text(response.data.username);
                        $('#auth-forms').addClass('hidden');
                        $('#forum-section').removeClass('hidden');
                        loadPosts();
                        loadUserProfile();
                        
                        // Start checking for new posts every 5 seconds
                        refreshInterval = setInterval(checkForNewPosts, 5000);
                    } else {
                        // User is not logged in
                        $('#auth-forms').removeClass('hidden');
                        $('#forum-section').addClass('hidden');
                        
                        // Clear refresh interval if exists
                        if (refreshInterval) {
                            clearInterval(refreshInterval);
                        }
                    }
                }
            });
        }
        
        // Client-side validation functions
        function validateUsername(username, isLogin = false) {
            if (!username) {
                return "Username is required";
            }
            
            if (!isLogin) {
                if (username.length < 4) {
                    return "Username must be at least 4 characters long";
                }
                
                if (username.length > 30) {
                    return "Username cannot exceed 30 characters";
                }
                
                if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                    return "Username can only contain letters, numbers, and underscores";
                }
            }
            
            return null;
        }
        
        function validatePassword(password, isLogin = false) {
            if (!password) {
                return "Password is required";
            }
            
            if (!isLogin) {
                if (password.length < 8) {
                    return "Password must be at least 8 characters long";
                }
                
                if (!/[A-Z]/.test(password)) {
                    return "Password must contain at least one uppercase letter";
                }
                
                if (!/[a-z]/.test(password)) {
                    return "Password must contain at least one lowercase letter";
                }
                
                if (!/[0-9]/.test(password)) {
                    return "Password must contain at least one number";
                }
            }
            
            return null;
        }
        
        // Register user
        function registerUser(username, password) {
            // Reset previous errors
            resetFormErrors('register-form');
            
            // Client-side validation
            const usernameError = validateUsername(username);
            const passwordError = validatePassword(password);
            
            if (usernameError) {
                showFormError('register-username-error', usernameError);
                return;
            }
            
            if (passwordError) {
                showFormError('register-password-error', passwordError);
                return;
            }
            
            $.ajax({
                url: 'register.php',
                type: 'POST',
                data: {
                    username: username,
                    password: password
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        showMessage(response.message);
                        // Clear form
                        $('#register-username').val('');
                        $('#register-password').val('');
                    } else {
                        // Display specific error message based on the response
                        if (response.message.includes("Username already exists")) {
                            showFormError('register-username-error', response.message);
                        } else if (response.message.includes("Username")) {
                            showFormError('register-username-error', response.message);
                        } else if (response.message.includes("Password")) {
                            showFormError('register-password-error', response.message);
                        } else {
                            showFormError('register-general-error', response.message);
                        }
                    }
                },
                error: function() {
                    showFormError('register-general-error', 'Server error during registration. Please try again later.');
                }
            });
        }
        
        // Login user
        function loginUser(username, password) {
            // Reset previous errors
            resetFormErrors('login-form');
            
            // Client-side validation
            const usernameError = validateUsername(username, true);
            const passwordError = validatePassword(password, true);
            
            if (usernameError) {
                showFormError('login-username-error', usernameError);
                return;
            }
            
            if (passwordError) {
                showFormError('login-password-error', passwordError);
                return;
            }
            
            $.ajax({
                url: 'login.php',
                type: 'POST',
                data: {
                    username: username,
                    password: password
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        showMessage(response.message);
                        checkAuth(); // Update UI
                    } else {
                        // Display specific error message based on the response
                        if (response.message.includes("Username")) {
                            showFormError('login-username-error', response.message);
                        } else if (response.message.includes("Password") || response.message.includes("password")) {
                            showFormError('login-password-error', response.message);
                        } else {
                            showFormError('login-general-error', response.message);
                        }
                    }
                },
                error: function() {
                    showFormError('login-general-error', 'Server error during login. Please try again later.');
                }
            });
        }
        
        // Logout user
        function logoutUser() {
            $.ajax({
                url: 'logout.php',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        showMessage(response.message);
                        checkAuth(); // Update UI
                    }
                },
                error: function() {
                    showMessage('Error during logout', false);
                }
            });
        }
        
        // Create post
        function createPost(title, content) {
            // Reset previous errors
            resetFormErrors('new-post-form');
            
            // Simple validation
            if (!title.trim()) {
                showFormError('post-title-error', 'Title is required');
                return;
            }
            
            if (!content.trim()) {
                showFormError('post-content-error', 'Content is required');
                return;
            }
            
            $.ajax({
                url: 'create_post.php',
                type: 'POST',
                data: {
                    title: title,
                    content: content
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        showMessage(response.message);
                        // Clear form
                        $('#post-title').val('');
                        $('#post-content').val('');
                        // Reload posts
                        loadPosts();
                        afterUserAction();
                    } else {
                        if (response.message.includes("Title")) {
                            showFormError('post-title-error', response.message);
                        } else if (response.message.includes("Content")) {
                            showFormError('post-content-error', response.message);
                        } else {
                            showFormError('post-general-error', response.message);
                        }
                    }
                },
                error: function() {
                    showFormError('post-general-error', 'Error creating post. Please try again.');
                }
            });
        }
        
        // Load posts
        function loadPosts() {
            $.ajax({
                url: 'get_posts.php',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        const posts = response.data.posts;
                        $('#posts-list').empty();
                        
                        if (posts.length === 0) {
                            $('#posts-list').html('<p>No posts yet. Be the first to post!</p>');
                            return;
                        }
                        
                        posts.forEach(post => {
                            const postDate = new Date(post.created_at);
                            const postElement = `
                                <div class="post" data-id="${post.post_id}">
                                    <div class="post-header">
                                        <span class="post-author">${post.username} <span class="rank-badge rank-${post.rank.replace(' ', '.')}">${post.rank}</span></span>
                                        <span class="post-time">${postDate.toLocaleString()}</span>
                                    </div>
                                    <h3>${post.title}</h3>
                                    <div class="post-content">${post.content}</div>
                                    
                                    <div class="reactions-bar" data-post-id="${post.post_id}">
                                        <button class="reaction-btn" data-type="like"><i class="fas fa-thumbs-up"></i> <span>0</span></button>
                                        <button class="reaction-btn" data-type="love"><i class="fas fa-heart"></i> <span>0</span></button>
                                        <button class="reaction-btn" data-type="laugh"><i class="fas fa-laugh"></i> <span>0</span></button>
                                        <button class="reaction-btn" data-type="wow"><i class="fas fa-surprise"></i> <span>0</span></button>
                                        <button class="reaction-btn" data-type="sad"><i class="fas fa-sad-tear"></i> <span>0</span></button>
                                        <button class="reaction-btn" data-type="angry"><i class="fas fa-angry"></i> <span>0</span></button>
                                    </div>
                                    
                                    <button class="comment-toggle" data-post-id="${post.post_id}">Show Comments</button>
                                    
                                    <div class="comments-section" id="comments-${post.post_id}">
                                        <div class="comments-list"></div>
                                        <form class="comment-form" data-post-id="${post.post_id}">
                                            <div class="form-group">
                                                <textarea class="comment-content" placeholder="Write a comment..." required></textarea>
                                            </div>
                                            <button type="submit">Comment</button>
                                        </form>
                                    </div>
                                </div>
                            `;
                            $('#posts-list').append(postElement);
                            
                            // Load reactions for this post
                            loadReactions(post.post_id);
                            
                            // Update last timestamp
                            if (post.timestamp > lastTimestamp) {
                                lastTimestamp = post.timestamp;
                            }
                        });
                    } else {
                        showMessage(response.message, false);
                    }
                },
                error: function() {
                    showMessage('Error loading posts', false);
                }
            });
        }

        // Load reactions for a post
        function loadReactions(postId) {
            $.ajax({
                url: 'get_reactions.php',
                type: 'GET',
                data: { post_id: postId },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        const reactionsBar = $(`.reactions-bar[data-post-id="${postId}"]`);
                        const reactions = response.data.reactions;
                        const userReactions = response.data.user_reactions;
                        
                        // Update reaction counts
                        for (const [type, count] of Object.entries(reactions)) {
                            reactionsBar.find(`.reaction-btn[data-type="${type}"] span`).text(count);
                        }
                        
                        // Highlight user's reactions
                        userReactions.forEach(type => {
                            reactionsBar.find(`.reaction-btn[data-type="${type}"]`).addClass('active');
                        });
                    }
                }
            });
        }
        
        // Add reaction to a post
        function addReaction(postId, reactionType) {
            $.ajax({
                url: 'add_reaction.php',
                type: 'POST',
                data: {
                    post_id: postId,
                    reaction_type: reactionType
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        // Reload reactions for this post
                        loadReactions(postId);
                        afterUserAction();
                    } else {
                        showMessage(response.message, false);
                    }
                },
                error: function() {
                    showMessage('Error adding reaction', false);
                }
            });
        }
        
        // Load comments for a post
        function loadComments(postId) {
            $.ajax({
                url: 'get_comments.php',
                type: 'GET',
                data: { post_id: postId },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        const commentsSection = $(`#comments-${postId}`);
                        const commentsList = commentsSection.find('.comments-list');
                        const comments = response.data.comments;
                        
                        commentsList.empty();
                        
                        if (comments.length === 0) {
                            commentsList.html('<p>No comments yet. Be the first to comment!</p>');
                            return;
                        }
                        
                        comments.forEach(comment => {
                            const commentDate = new Date(comment.created_at);
                            const avatarSrc = comment.avatar ? `uploads/avatars/${comment.avatar}` : '/derek-yux.github.io/Assets/default.png';
                            
                            const commentElement = `
                                <div class="comment" data-id="${comment.comment_id}">
                                    <div class="comment-header">
                                        <span class="comment-author">
                                            <img src="${avatarSrc}" alt="Avatar" class="avatar">
                                            ${comment.username}
                                        </span>
                                        <span class="comment-time">${commentDate.toLocaleString()}</span>
                                    </div>
                                    <div class="comment-content">${comment.content}</div>
                                </div>
                            `;
                            commentsList.append(commentElement);
                        });
                    } else {
                        showMessage(response.message, false);
                    }
                },
                error: function() {
                    showMessage('Error loading comments', false);
                }
            });
        }
        
        // Add comment to a post
        function addComment(postId, content) {
            $.ajax({
                url: 'add_comment.php',
                type: 'POST',
                data: {
                    post_id: postId,
                    content: content
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        // Reload comments for this post
                        loadComments(postId);
                        // Clear comment form
                        $(`.comment-form[data-post-id="${postId}"] .comment-content`).val('');
                        afterUserAction();
                    } else {
                        showMessage(response.message, false);
                    }
                },
                error: function() {
                    showMessage('Error adding comment', false);
                }
            });
        }

        function updateProfileStats() {
            return $.ajax({
                url: 'get_profile.php',
                type: 'GET',
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        const profile = response.data.profile;
                        
                        // Update profile stats
                        $('#profile-posts').text(profile.post_count);
                        $('#profile-comments').text(profile.comment_count);
                        $('#profile-points').text(profile.points);
                        $('#profile-rank').text(profile.rank).attr('class', 'rank-badge rank-' + profile.rank.replace(' ', '.'));
                        
                        // Update points needed for next rank
                        updatePointsNeeded(profile.points, profile.rank);
                    }
                }
            });
        }

        // Extract the points needed calculation to a separate function
        function updatePointsNeeded(currentPoints, currentRank) {
            switch(currentRank) {
                case 'Newcomer':
                    pointsNeeded = 20 - currentPoints;
                    nextRank = 'Regular';
                    break;
                case 'Regular':
                    pointsNeeded = 50 - currentPoints;
                    nextRank = 'Active Member';
                    break;
                case 'Active Member':
                    pointsNeeded = 100 - currentPoints;
                    nextRank = 'Forum Expert';
                    break;
                case 'Forum Expert':
                    pointsNeeded = 200 - currentPoints;
                    nextRank = 'Discussion Master';
                    break;
                case 'Discussion Master':
                    pointsNeeded = 500 - currentPoints;
                    nextRank = 'Forum Legend';
                    break;
                case 'Forum Legend':
                    $('#points-needed').text('You reached the highest rank!');
                    return;
            }
            
            if (pointsNeeded > 0) {
                $('#points-needed').text(`${pointsNeeded} points needed for ${nextRank}`);
            } else {
                $('#points-needed').text('You qualify for a rank up!');
            }
        }

        // Update user profile
        function updateProfile(formData) {
            $.ajax({
                url: 'update_profile.php',
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        showMessage(response.message);
                        $('#edit-profile-modal').hide();
                        loadUserProfile();
                    } else {
                        if (response.message.includes("Display name")) {
                            showFormError('display-name-error', response.message);
                        } else if (response.message.includes("Bio")) {
                            showFormError('bio-error', response.message);
                        } else if (response.message.includes("avatar") || response.message.includes("file")) {
                            showFormError('avatar-error', response.message);
                        } else {
                            showFormError('edit-profile-general-error', response.message);
                        }
                    }
                },
                error: function() {
                    showFormError('edit-profile-general-error', 'Error updating profile. Please try again.');
                }
            });
        }

        // Make sure we update stats after user actions
        function afterUserAction() {
            // Update the stats if the profile modal is visible
            if ($('#profile-modal').is(':visible')) {
                updateProfileStats();
            }
        }
        
        // Check for new posts
        function checkForNewPosts() {
            if (lastTimestamp === 0) return;
            
            $.ajax({
                url: 'get_posts.php',
                type: 'GET',
                data: {
                    last_timestamp: lastTimestamp
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success && response.data.count > 0) {
                        // New posts found, reload all posts
                        loadPosts();
                    }
                }
            });
        }
        
        // Event listeners
        $(document).ready(function() {
            // Check if user is already logged in
            checkAuth();
            
            // Register form submission
            $('#register-form').on('submit', function(e) {
                e.preventDefault();
                const username = $('#register-username').val();
                const password = $('#register-password').val();
                registerUser(username, password);
            });
            
            // Login form submission
            $('#login-form').on('submit', function(e) {
                e.preventDefault();
                const username = $('#login-username').val();
                const password = $('#login-password').val();
                loginUser(username, password);
            });
            
            // Logout button
            $('#logout-btn').on('click', function() {
                logoutUser();
            });
            
            // New post submission
            $('#new-post-form').on('submit', function(e) {
                e.preventDefault();
                const title = $('#post-title').val();
                const content = $('#post-content').val();
                createPost(title, content);
            });
            
            // Clear error when user starts typing again
            $('input, textarea').on('input', function() {
                $(this).removeClass('error-field');
                const errorId = $(this).attr('id') + '-error';
                $('#' + errorId).hide();
            });

            // Reaction button click
            $(document).on('click', '.reaction-btn', function() {
                const postId = $(this).parent().data('post-id');
                const reactionType = $(this).data('type');
                addReaction(postId, reactionType);
            });
            
            // Comment toggle click
            $(document).on('click', '.comment-toggle', function() {
                const postId = $(this).data('post-id');
                const commentsSection = $(`#comments-${postId}`);
                
                if (commentsSection.is(':visible')) {
                    commentsSection.hide();
                    $(this).text('Show Comments');
                } else {
                    // Load comments when showing the section
                    loadComments(postId);
                    commentsSection.show();
                    $(this).text('Hide Comments');
                }
            });
            
            // Comment form submission
            $(document).on('submit', '.comment-form', function(e) {
                e.preventDefault();
                const postId = $(this).data('post-id');
                const content = $(this).find('.comment-content').val();
                
                if (content.trim()) {
                    addComment(postId, content);
                }
            });
            
            // Profile button click
            $('#profile-btn').on('click', function() {
                $('#profile-modal').show();
                updateProfileStats();
            });
            
            // Close profile modal
            $('#close-profile-modal').on('click', function() {
                $('#profile-modal').hide();
            });
            
            // Edit profile button click
            $('#edit-profile-btn').on('click', function() {
                $('#profile-modal').hide();
                $('#edit-profile-modal').show();
            });
            
            // Close edit profile modal
            $('#close-edit-profile-modal').on('click', function() {
                $('#edit-profile-modal').hide();
            });
            
            // Edit profile form submission
            $('#edit-profile-form').on('submit', function(e) {
                e.preventDefault();
                resetFormErrors('edit-profile-form');
                
                const formData = new FormData(this);
                updateProfile(formData);
            });
            
            // Close modals when clicking outside
            $(window).on('click', function(e) {
                if ($(e.target).hasClass('modal')) {
                    $('.modal').hide();
                }
            });
        });
    </script>
     <footer>
        <div class="container">
            <p>&copy; 2025 You You News. All Rights Reserved.</p>
            <p>Connect with us on social media</p>
            <div id="footerlink">
                <a href="/derek-yux.github.io/Terms_and_Conditions/terms_of_service">Terms of Service</a>
            </div>
            <br>
            <img src="/derek-yux.github.io/Assets/sectigo_trust_seal_md_106x42.png" alt="Verified Logo">
        </div>
    </footer>
</body>
</html>